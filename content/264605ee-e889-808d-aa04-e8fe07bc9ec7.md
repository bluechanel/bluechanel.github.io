---
title: ğŸ§¬ LangGraphæ•™ç¨‹(ä¸‰)ï¼šä¸ºä½ çš„Agentæ·»åŠ è®°å¿†ï¼ˆCheckpointæŒä¹…åŒ–ä¸Mem0ï¼‰
description: æœ¬æ–‡æ˜¯ ã€ŠLangGraphå…¥é—¨å…¨è§£ã€‹ç³»åˆ—çš„ç¬¬ä¸‰ç¯‡ã€‚åœ¨è¿™ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬ä¸ºèŠå¤©æœºå™¨äººå¢åŠ é•¿çŸ­æœŸè®°å¿†èƒ½åŠ›ï¼Œå¹¶ä½¿ç”¨redisæŒä¹…åŒ–è®°å¿†ã€‚ä»¥åŠä½¿ç”¨Mem0ä¸ºchat botå¢åŠ ç”¨æˆ·çº§åˆ«çš„è®°å¿†ã€‚LangGraphè®°å¿†, LangGraph Checkpoint, LangGraph Redisè®°å¿†, LangGraph Mem0
date: 2025-09-04
updateDate: 2025-09-04
tags: ["LLM","Prompt","LangChain","LangGraph","AI"]
cover: cover/264605ee-e889-808d-aa04-e8fe07bc9ec7_9518555453a138560623f1c4e847e47f.png
---

æœ¬æ–‡æ˜¯ **ã€ŠLangGraphå…¥é—¨å…¨è§£ã€‹**[**LangGraphå…¥é—¨æŒ‡å—ï¼šä»åŸºç¡€ChatBotåˆ°å¤šæ™ºèƒ½ä½“å®æˆ˜**](https://www.wileyzhang.com/posts/264605ee-e889-806e-b847-ce4e7bcba614) ç³»åˆ—çš„ç¬¬ä¸‰ç¯‡ã€‚åœ¨è¿™ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬ä¸ºèŠå¤©æœºå™¨äººå¢åŠ é•¿çŸ­æœŸè®°å¿†èƒ½åŠ›ï¼Œå¹¶ä½¿ç”¨redisæŒä¹…åŒ–è®°å¿†ã€‚ä»¥åŠä½¿ç”¨Mem0ä¸ºchat botå¢åŠ ç”¨æˆ·çº§åˆ«çš„è®°å¿†ã€‚å¦‚æœå‡ºä½ æ˜¯æ–°æ‰‹ï¼Œå»ºè®®å…ˆé˜…è¯»ä¸»æŒ‡å—ä»¥äº†è§£LangGraphçš„å…¨è²Œã€‚


# ä¸‰ã€åœ¨LangGraphä¸­æ·»åŠ è®°å¿†


æˆ‘ä»¬ç®€å•åŒºåˆ†ä¸ºä»»åŠ¡çº§åˆ«è®°å¿†ã€ç”¨æˆ·çº§åˆ«è®°å¿†ï¼Œæˆ–çŸ­æœŸè®°å¿†ã€é•¿æœŸè®°å¿†

- **ä»»åŠ¡çº§åˆ«è®°å¿†ï¼ˆCheckpointingï¼‰**ï¼šé€‚åˆçŸ­æœŸä¼šè¯å’Œä»»åŠ¡æµç¨‹çš„çŠ¶æ€ä¿å­˜ï¼Œè½»é‡æ˜“ç”¨ã€‚
- **ç”¨æˆ·çº§åˆ«è®°å¿†ï¼ˆMem0ï¼‰**ï¼šé€‚åˆéœ€è¦é•¿æœŸäº¤äº’å’Œä¸ªæ€§åŒ–ä½“éªŒçš„åº”ç”¨ï¼Œæ¯”å¦‚æ™ºèƒ½å®¢æœã€AI åŠ©æ‰‹ã€‚

ä¸¤è€…ç»“åˆï¼Œåœ¨ä¸åŒå±‚é¢å¢å¼º LangGraph åº”ç”¨çš„æ™ºèƒ½åŒ–å’Œå¯æŒç»­æ€§ã€‚


## ä»»åŠ¡çº§è®°å¿†


åœ¨LangGraphä¸­åˆè¢«ç§°ä¸º**æ£€æŸ¥ç‚¹**ï¼ˆcheckpointingï¼‰ï¼Œå®ƒæ˜¯ LangGraph èƒ½å¤Ÿæ”¯æŒ **é•¿å‘¨æœŸä»»åŠ¡æ‰§è¡Œ** å’Œ **æ–­ç‚¹ç»­æ‰§è¡Œ** çš„å…³é”®æœºåˆ¶ã€‚


åœ¨å‰ä¸¤èŠ‚ä¸­ï¼Œæˆ‘ä»¬é€šè¿‡æ‰‹åŠ¨ç»´æŠ¤ä¸€ä¸ª `messages` åˆ—è¡¨æ¥å®ç°å¤šè½®å¯¹è¯ã€‚ç„¶è€Œï¼Œè¿™ç§æ–¹å¼åœ¨é¢å¯¹ **å¤šç”¨æˆ·ã€å¤šä»»åŠ¡** ä»¥åŠ **å¤æ‚å›¾ç»“æ„** æ—¶ï¼Œç»´æŠ¤æˆæœ¬ä¼šæ€¥å‰§ä¸Šå‡ã€‚


![1280X1280.png](images/264605ee-e889-808d-aa04-e8fe07bc9ec7/264605ee-e889-808d-aa04-e8fe07bc9ec7_f7897e7a94be4db5b6c57dae748aac87.png)


### æ·»åŠ è®°å¿†æ¨¡å—


ä¸ºäº†è§£å†³è¿™ä¸€é—®é¢˜ï¼ŒLangGraph æä¾›äº†æ›´ä¸ºç®€æ´çš„è®°å¿†æ¨¡å—ã€‚åªéœ€ä¿®æ”¹3è¡Œä»£ç ï¼Œå°±èƒ½å¯ç”¨å†…å­˜è®°å¿†ï¼š


```python
from langgraph.checkpoint.memory import InMemorySaver
memory = InMemorySaver()
# ...çœç•¥é‡å¤ä»£ç 
app = graph_builder.compile(checkpointer=memory)
```


åœ¨è°ƒç”¨æ—¶ï¼Œåªéœ€é…ç½® `thread_id`ï¼š


```python
# ...çœç•¥é‡å¤ä»£ç ï¼Œæ³¨æ„ config thread_idçš„é…ç½®
response = app.invoke({"messages": {"role": "user", "content": user_input}},
                      config = {"configurable": {"thread_id": "1"}})
```


è¿™æ ·ä¾¿å®ç°äº†åŸºäºå†…å­˜çš„è®°å¿†ã€‚ä½†éœ€è¦æ³¨æ„çš„æ˜¯ï¼š**ä¸€æ—¦ç¨‹åºé‡å¯ï¼Œè®°å¿†ä¼šä¸¢å¤±**ã€‚


### ä½¿ç”¨ Redis æŒä¹…åŒ–è®°å¿†


ä¸ºäº†é¿å…é‡å¯å¯¼è‡´æ•°æ®ä¸¢å¤±ï¼Œæˆ‘ä»¬å¯ä»¥æ”¹ç”¨ **Redis** ä½œä¸ºè®°å¿†å­˜å‚¨ã€‚åªè¦ Redis ä¿æŒæ­£å¸¸è¿è¡Œï¼Œè®°å¿†å°±èƒ½æŒç»­å­˜åœ¨ã€‚

1. å®‰è£…åŒ»ä¾èµ–

    ```plain text
    pip install langgraph-checkpoint-redis
    ```

2. ä¿®æ”¹ä»£ç ï¼š

    ```python
    from redis import Redis
    from langgraph.checkpoint.redis import RedisSaver
    
    redis_client = Redis(
        host="127.0.0.1",
        port=6379,
        password="Tali1234"
    )
    memory = RedisSaver(redis_client=redis_client)
    ```


Redis ä¸­çš„å­˜å‚¨å†…å®¹å¤§è‡´å¦‚ä¸‹ï¼š


![1280X1280_%281%29.png](images/264605ee-e889-808d-aa04-e8fe07bc9ec7/264605ee-e889-808d-aa04-e8fe07bc9ec7_9bac6ff251df49adf59c7c10415d3929.png)


åœ¨ PyPI ä¸Šæœç´¢ `langgraph-checkpoint`ï¼Œè¿˜èƒ½å‘ç°æ›´å¤šæ•°æ®åº“çš„å­˜å‚¨å®ç°ï¼Œæ–¹ä¾¿ä¸åŒåœºæ™¯ä½¿ç”¨ã€‚


![43797a91-3e42-475c-8159-7017c38825a5.png](images/264605ee-e889-808d-aa04-e8fe07bc9ec7/264605ee-e889-808d-aa04-e8fe07bc9ec7_7f67bf460354ffacc69279266879055f.png)


### æ•ˆæœå¦‚ä¸‹


![74c91a0f-fbc3-4595-ab6f-f2da850c1b46.png](images/264605ee-e889-808d-aa04-e8fe07bc9ec7/264605ee-e889-808d-aa04-e8fe07bc9ec7_63e54ba62dd49dab5ab7d466ea9845dd.png)


## **LangGraphé›†æˆMem0(ç”¨æˆ·çº§åˆ«è®°å¿†)**


ä»»åŠ¡çº§åˆ«è®°å¿†å¸®åŠ©æˆ‘ä»¬ä¿æŒå•ä¸ªå¯¹è¯çš„ä¸Šä¸‹æ–‡ï¼Œ **Mem0** æ›´è¿›ä¸€æ­¥ï¼Œæä¾›äº† **è·¨ä»»åŠ¡ã€è·¨ä¼šè¯çš„ç”¨æˆ·çº§åˆ«è®°å¿†**ã€‚


**Mem0 æ˜¯ä¸€ä¸ªè½»é‡åŒ–ã€æ¨¡å—åŒ–çš„æ™ºèƒ½è®°å¿†å±‚æ¡†æ¶**ï¼Œå…¶ç›®æ ‡æ˜¯ï¼š

> â€œé€šè¿‡ä¿ç•™ç”¨æˆ·åå¥½ä¸ä¸Šä¸‹æ–‡ä¿¡æ¯ï¼Œéšç€æ—¶é—´æ¨ç§»ä¸æ–­é€‚åº”ï¼Œæä¾›ä¸ªæ€§åŒ–å’Œé«˜æ•ˆçš„äº¤äº’ä½“éªŒã€‚â€

å®ƒæ”¯æŒ **å¯¹è¯å±‚ã€ç”¨æˆ·å±‚å’Œ Agent å±‚** çš„å¤šå±‚è®°å¿†ç»„ç»‡æ–¹å¼ï¼Œå¸¸ç”¨äºèŠå¤©æœºå™¨äººã€RPA è‡ªåŠ¨åŒ–åŠ©æ‰‹ã€AI Copilot ç­‰åœºæ™¯ã€‚


Mem0 çš„è®°å¿†æµç¨‹åˆ†ä¸º **æå–** å’Œ **æ›´æ–°** ä¸¤ä¸ªé˜¶æ®µï¼š

- åœ¨æå–é˜¶æ®µï¼Œç³»ç»Ÿä¼šä» **æœ€æ–°å¯¹è¯ã€æ»šåŠ¨æ‘˜è¦ã€æœ€è¿‘ m æ¡å¯¹è¯** ä¸­æŠ“å–å…³é”®ä¿¡æ¯ï¼Œå¹¶å€ŸåŠ© LLM ç”Ÿæˆç®€æ´å€™é€‰è®°å¿†ã€‚
- åœ¨åå°ï¼Œé•¿æœŸæ‘˜è¦ä¼šå¼‚æ­¥æ›´æ–°ï¼Œä»è€Œä¿è¯æ¨ç†æµç¨‹ä¸ä¼šè¢«æ‰“æ–­ã€‚
> æ›´å¤šå†…å®¹ï¼Œè§ä¹‹å‰çš„ä¸“é¢˜æ–‡ç« https://mp.weixin.qq.com/s/rqnd8nVtdtH2DXS4xhGQhQ

### å®‰è£… Mem0


```plain text
pip install mem0ai
```


### ç¤ºä¾‹ä»£ç ï¼ˆæ ¸å¿ƒé€»è¾‘å·²æ ‡æ³¨ï¼‰


```python
from typing import Annotated
from typing_extensions import TypedDict
from langchain_openai import ChatOpenAI
from langgraph.graph import StateGraph, START
from langgraph.graph.message import add_messages
from langchain_tavily import TavilySearch
from langgraph.prebuilt import ToolNode, tools_condition
from mem0 import Memory
from langchain_openai import OpenAIEmbeddings

openai_embeddings = OpenAIEmbeddings(
    model="gte-large-zh",
    check_embedding_ctx_length=False
)
# æ­¤å¤„å®šä¹‰ä½ è‡ªå·±çš„æ¨¡å‹
llm = ChatOpenAI(model="qwen3_32")

# å®šä¹‰å·¥å…·
tool = TavilySearch(max_results=2)
tools = [tool]
# å·¥å…·ç»‘å®šåˆ°æ¨¡å‹
llm_with_tools = llm.bind_tools(tools)
# åˆ›å»ºMem0è®°å¿†é…ç½®
config = {
    "vector_store": {
        "provider": "milvus",
        "config": {
            "collection_name": "mem0",
            "embedding_model_dims": "1024",
            "url": "http://127.0.0.1:9530",
            "token": "root:root",
        },
    },
    "embedder": {
        "provider": "langchain",
        "config": {
            "model": openai_embeddings,
        },
    },
    "llm": {
        "provider": "openai",
        "config": {
            "model": "qwen3_32",
            "temperature": 0.2,
            "max_tokens": 20000,
        },
    },
}
memory = Memory.from_config(config)

# å®šä¹‰å›¾çŠ¶æ€
class State(TypedDict):
    messages: Annotated[list, add_messages]  # æ­¤å¤„ç»´æŠ¤å®Œæ•´çš„æ¶ˆæ¯å†å²
    mem0_user_id: str # å¢åŠ ç”¨æˆ·id

graph = StateGraph(State)

def chatbot(state: State):
    messages = state["messages"]
    user_id = state["mem0_user_id"]

    # æ£€ç´¢è®°å¿†
    memories = memory.search(messages[-1].content, user_id=user_id)

    context = "Relevant information from previous conversations:\n"
    for m in memories.get("results", []):
        context += f"- {m['memory']}\n"

    system_message = {"role":"system", "content": f"""You are a helpful customer support assistant. Use the provided context to personalize your responses and remember user preferences and past interactions.
    {context}"""}

    full_messages = [system_message] + messages
    response = llm_with_tools.invoke(full_messages)

    # å­˜å‚¨è®°å¿†
    memory.add(
        f"User: {messages[-1].content}\nAssistant: {response.content}", user_id=user_id
    )
    return {"messages": [response]}

# ä½¿ç”¨LangGraphæä¾›çš„å·¥å…·èŠ‚ç‚¹
tool_node = ToolNode(tools=tools)

graph.add_node("chatbot", chatbot)
# æ·»åŠ å·¥å…·èŠ‚ç‚¹
graph.add_node("tools", tool_node)
# æ·»åŠ å·¥å…· æ¡ä»¶åˆ†æ”¯
graph.add_conditional_edges(
    "chatbot",
    tools_condition,
)
graph.add_edge("tools", "chatbot")
graph.add_edge(START, "chatbot")

app = graph.compile()

if __name__ == "__main__":
    while True:
        user_input = input("ğŸ‘¨ğŸ’»: ")
        if user_input.lower() in ["quit", "exit", "q"]:
            print("Exiting...")
            break
        response = app.invoke({"messages": {"role": "user", "content": user_input}, "mem0_user_id":"mem0_wiley"})
        messages = response["messages"]
        print(f'ğŸ¤–: {response["messages"][-1].content}')
```


### æ•ˆæœå¦‚ä¸‹


![8b75d01e-cf6b-4e63-b439-f62b3951426a.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/da864e11-683f-4c2d-a264-16ecdf57fff9/6c5b009e-4920-4d76-97ee-9b06c7fb0174/8b75d01e-cf6b-4e63-b439-f62b3951426a.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=ASIAZI2LB466V2YLC6M7%2F20250904%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20250904T081913Z&X-Amz-Expires=3600&X-Amz-Security-Token=IQoJb3JpZ2luX2VjEO%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJGMEQCIG8DysEwOjMyIjE3gvLSvgyGTX9FG34q9Nmaanbh6nwQAiBlxHiddm0JH%2BNQ7oqqOYd7Pp3W%2BWLzkY5lRfebPxLKEyr%2FAwhYEAAaDDYzNzQyMzE4MzgwNSIMWGavmUdsLqMGAORHKtwDszTMLKtzqGbTgi%2B6kR7WJ73WhjzdXtS%2FNLrFgBDkoELd%2Ft4B1PqjuuUqnU%2B6kJmPZHRRaOTOtpaAZZVbCuMDsGufk4hlXD6hfDSGXNSH4NN8IpCf6Q7WMOzBirWwwUttLKz1W4ICPTkfsNvDdVJMrw%2B22%2BkcZtpm537nGv5MhI7qbioQEJFhszL%2FenDw04hwLQU0j7LMTMbuK2a7EhNOD1TziZis5aKxQFieo2rjEnDDBcmIjJT%2F7CRFZBfYglXt%2B2BXUelh45f8pqxrHZ026NK0UnBAgy0%2BqmkS1fEir8sFl%2FoNiAMF5C5t4yLCIIcx7sE77ZZqxbU42LHk5AiPXgRQcAVtgg96PMFFvE7Je8AlNI%2BOqM9n2xBr%2FR1m5L14Dfkt2FF7zCeoXcRS6b6EAKNKKqLo%2B1yLYdQde63FrFj4q5wnlpOojCI0HQGbvY5jS4IIyQrFbKiVkxiA5rOYm%2FhpIXHMaN1fwLQD5IF9ZLZiCwh41PHtN%2B7nxuthNLujdm2vVGXuZu6Vje%2BrcBtBm8HiSNdppfifK56VU4PaBAy8NBICKnwloRbBJhDS5qItesr4MuMr%2FPkh%2BcbJ4UFtimA0%2BmH9owh9r%2BBcEISJmK6TM99ab1yv9UYXhjkw5%2B7kxQY6pgFMEBCjImfRw3a20%2BOglVTAEXI8nPheZJI6%2Bm23RxNN3X4%2FxZeJoL4qwTlgGs1C2JT%2BDteosXFETDxTrXzWvAwa%2FsoQPX%2FdubnWrakmAOxlgjTmRUF3eBPAPkjITmLaTVA5M67%2FxP8uPPr6cZRrlz7pgKp3WaCpP5e%2BjMXcEjg8dIClKea2bclg0IutlHk3uVOWol1mKfLPWDF8xqmiOyDt5BDiepKR&X-Amz-Signature=e461780e59746a0a3fbec3a1f0ca97649ed237a29e940f60790fdee85219f67d&X-Amz-SignedHeaders=host&x-amz-checksum-mode=ENABLED&x-id=GetObject)

