---
title: ğŸ§¬ LangGraphæ•™ç¨‹(å››)ï¼šå®ç°äººæœºååŒï¼ˆHuman-in-the-loopï¼‰çš„å…³é”®æŠ€å·§
description: æœ¬æ–‡æ˜¯ ã€ŠLangGraphå…¥é—¨å…¨è§£ã€‹ç³»åˆ—çš„ç¬¬å››ç¯‡ã€‚åœ¨è¿™ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬æš‚æ—¶ç§»é™¤äº†æœç´¢èƒ½åŠ›ï¼Œä¸ºchat botå¢åŠ å‘ç”¨æˆ·æ±‚åŠ©çš„èƒ½åŠ›ï¼Œä¹Ÿå°±æ˜¯äººæœºååŒï¼Œè¿™åœ¨å®é™…å¼€å‘ä¸­éå¸¸çš„æœ‰ç”¨ã€‚LangGraphäººæœºäº¤äº’, Human-in-the-loop, LangGraph interrupt, AIäººå·¥å¹²é¢„
date: 2025-09-04
updateDate: 2025-09-04
tags: ["LLM","Prompt","LangChain","LangGraph","AI"]
cover: cover/264605ee-e889-80f8-a8ce-e89efa0548c5_318cebbc702cfea8961ec65dbff40aa6.png
---

æœ¬æ–‡æ˜¯ **ã€ŠLangGraphå…¥é—¨å…¨è§£ã€‹**[**LangGraphå…¥é—¨æŒ‡å—ï¼šä»åŸºç¡€ChatBotåˆ°å¤šæ™ºèƒ½ä½“å®æˆ˜**](https://www.wileyzhang.com/posts/264605ee-e889-806e-b847-ce4e7bcba614) ç³»åˆ—çš„ç¬¬å››ç¯‡ã€‚åœ¨è¿™ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬æš‚æ—¶ç§»é™¤äº†æœç´¢èƒ½åŠ›ï¼Œä¸ºchat botå¢åŠ å‘ç”¨æˆ·æ±‚åŠ©çš„èƒ½åŠ›ï¼Œä¹Ÿå°±æ˜¯äººæœºååŒï¼Œè¿™åœ¨å®é™…å¼€å‘ä¸­éå¸¸çš„æœ‰ç”¨ã€‚å¦‚æœå‡ºä½ æ˜¯æ–°æ‰‹ï¼Œå»ºè®®å…ˆé˜…è¯»ä¸»æŒ‡å—ä»¥äº†è§£LangGraphçš„å…¨è²Œã€‚


# åœ¨LangGraphä¸­å®ç°äººæœºäº¤äº’


åœ¨å‰å‡ ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬ä»‹ç»äº† LangGraph å®ç°å¤šè½®å¯¹è¯ã€å·¥å…·è°ƒç”¨å’Œè®°å¿†ã€‚ä½†åœ¨å®é™…åº”ç”¨åœºæ™¯é‡Œï¼Œå®Œå…¨è®©Agentè‡ªä¸»åšå†³ç­–å¹¶ä¸æ€»æ˜¯æœ€ä¼˜è§£ã€‚**æœ‰äº›ç¯èŠ‚éœ€è¦äººè¿›è¡Œç¡®è®¤æˆ–å¹²é¢„**ï¼Œä¾‹å¦‚ï¼š

- è´¢åŠ¡æˆ–æ³•å¾‹ç±»åº”ç”¨ä¸­ï¼Œæ¨¡å‹ç”Ÿæˆçš„å»ºè®®å¿…é¡»ç»è¿‡äººå·¥ç¡®è®¤ã€‚
- åŒ»ç–—ç±»åº”ç”¨ä¸­ï¼ŒAI å¯ä»¥ç»™å‡ºåˆæ­¥è¯Šæ–­ï¼Œä½†åŒ»ç”Ÿæ‰æ˜¯æœ€ç»ˆçš„å†³ç­–è€…ã€‚
- å¤šå·¥å…·åä½œæ—¶ï¼ŒAI å¯èƒ½ä¸ç¡®å®šè¯¥é€‰ç”¨å“ªä¸ªå·¥å…·ï¼Œéœ€è¦äººç±»æ¥å†³å®šã€‚

è¿™å°±æ˜¯ **Human-in-the-loop (HITL)** çš„ä»·å€¼æ‰€åœ¨ï¼šåœ¨å…³é”®èŠ‚ç‚¹å¼•å…¥äººå·¥ç¡®è®¤ï¼Œä¿è¯æ™ºèƒ½åº”ç”¨æ—¢é«˜æ•ˆåˆå¯é ã€‚


## ä»€ä¹ˆæ˜¯ Human-in-the-loopï¼Ÿ


HITL å°±æ˜¯**äººåœ¨æŸäº›ç¯èŠ‚ä½œä¸ºèŠ‚ç‚¹å‚ä¸å†³ç­–**ã€‚åœ¨ LangGraph ä¸­ï¼Œå®ƒé€šå¸¸é€šè¿‡ä»¥ä¸‹æ–¹å¼å®ç°ï¼š

1. **å·¥å…·èŠ‚ç‚¹ï¼ˆTool Nodeï¼‰**ï¼šå®šä¹‰ä¸€ä¸ªäººç±»å·¥å…·ï¼Œæ¨¡å‹å¯ä»¥è°ƒç”¨è¯¥â€œäººç±»å·¥å…·â€ï¼ŒæŠŠé—®é¢˜äº¤ç»™ç”¨æˆ·ç¡®è®¤ã€‚
2. **ä¸­æ–­/ç­‰å¾…æœºåˆ¶**ï¼šLangGraph ä¼šæš‚åœæ‰§è¡Œï¼Œç›´åˆ°äººç±»æä¾›åé¦ˆï¼Œç”¨åˆ°äº†ä¸Šä¸€èŠ‚çš„ä»»åŠ¡è®°å¿†ã€‚
3. **ç»§ç»­æ‰§è¡Œ**ï¼šäººç±»ç¡®è®¤æˆ–ä¿®æ­£åï¼Œæµç¨‹ç»§ç»­ã€‚

è¿™æ ·åšçš„å¥½å¤„æ˜¯ï¼š

- æ¨¡å‹ç»“æœæ›´å¯æ§
- åœ¨å¤šå·¥å…·ååŒæ—¶å‡å°‘é”™è¯¯è°ƒç”¨
- æå‡ç³»ç»Ÿçš„å®‰å…¨æ€§å’Œå¯è§£é‡Šæ€§

## åœ¨ LangGraph ä¸­å®ç° HITL


åªéœ€è¦å®šä¹‰ä¸€ä¸ªäººæœºäº¤äº’å·¥å…·å³å¯ã€‚


```python
from langgraph.types import interrupt
from langchain_core.tools import tool
@tool
def human_assistance(query: str) -> str:
"""è¯·æ±‚äººç±»å¸®åŠ©ï¼Œæ¨¡å‹åœ¨ä¸ç¡®å®šæ—¶ä¼šè°ƒç”¨æ­¤å·¥å…·"""human_response = interrupt({"query": query})
    return human_response["data"]

tools = [human_assistance]
llm_with_tools = llm.bind_tools(tools)
```


### å®Œæ•´ä»£ç å¦‚ä¸‹


æˆ‘ä»¬ç§»é™¤ä¹‹å‰èŠå¤©æœºå™¨äººçš„æœç´¢å·¥å…·ï¼Œå½“æˆ‘ä»¬è¯¢é—®å®æ—¶ä¿¡æ¯æ—¶ï¼Œæ¨¡å‹å°±ä¼šè°ƒç”¨äººæœºäº¤äº’å·¥å…·ã€‚


```python
from typing import Annotated
from typing_extensions import TypedDict
from langchain_openai import ChatOpenAI
from langgraph.graph import StateGraph, START, END
from langgraph.graph.message import add_messages
from langgraph.prebuilt import ToolNode, tools_condition
from langgraph.types import Command, interrupt
from langchain_core.tools import tool
from langgraph.checkpoint.memory import InMemorySaver
memory = InMemorySaver()
# æ­¤å¤„å®šä¹‰ä½ è‡ªå·±çš„æ¨¡å‹
llm = ChatOpenAI(model="qwen3_32")

# å®šä¹‰äººæœºäº¤äº’å·¥å…·
@tool
def human_assistance(query: str) -> str:
"""è¯·æ±‚äººç±»å¸®åŠ©ï¼Œæ¨¡å‹åœ¨ä¸ç¡®å®šæ—¶ä¼šè°ƒç”¨æ­¤å·¥å…·"""human_response = interrupt({"query": query})
    return human_response["data"]

tools = [human_assistance]
llm_with_tools = llm.bind_tools(tools)

# å®šä¹‰å›¾çŠ¶æ€
class State(TypedDict):
    messages: Annotated[list, add_messages]  # æ­¤å¤„ç»´æŠ¤å®Œæ•´çš„æ¶ˆæ¯å†å²

graph = StateGraph(State)

def chatbot(state: State):
    return {"messages": [llm_with_tools.invoke(state["messages"])]}
tool_node = ToolNode(tools=tools)

graph.add_node("chatbot", chatbot)
graph.add_node("tools", tool_node)
graph.add_conditional_edges(
    "chatbot",
    tools_condition,
)
graph.add_edge("tools", "chatbot")
graph.add_edge(START, "chatbot")
graph.add_edge("chatbot", END)

app = graph.compile(checkpointer=memory)

if __name__ == "__main__":
    thread_id = "multi_tool_hitl_demo"
    pending_interrupt = False
    # ä¿®æ”¹æ­¤å¤„å¯¹è¯ä»£ç ï¼ŒåŒºåˆ†æ™®é€šå¯¹è¯å’Œæ¨¡å‹è¯·æ±‚äººç±»å¸®åŠ©
    while True:
        if not pending_interrupt:
            user_input = input("ğŸ‘¨ğŸ’»: ")
            if user_input.lower() in ["quit", "exit", "q"]:
                print("Exiting...")
                break
            response = app.invoke(
                {"messages": {"role": "user", "content": user_input}},
                config={"configurable": {"thread_id": thread_id}},
            )
        else:
            # äººç±»è¾“å…¥ï¼Œæ¢å¤ä¸­æ–­
            human_input = input("ğŸ‘¨ğŸ’»(äººå·¥ä»‹å…¥): ")
            human_command = Command(resume={"data": human_input})
            response = app.invoke(
                human_command,
                config={"configurable": {"thread_id": thread_id}},
            )

        # åˆ¤æ–­ä¸­æ–­è¿˜æ˜¯æ­£å¸¸è¾“å‡º
        if "__interrupt__" in response:
            pending_interrupt = True
            query = response["__interrupt__"][0].value["query"]
            print(f"ğŸ¤– <human_assistance> è¯·æ±‚äººå·¥å¸®åŠ©: {query}")
        else:
            pending_interrupt = False
            print(f'ğŸ¤–: {response["messages"][-1].content}')
```


### æ•ˆæœå¦‚ä¸‹


![c0bceacf-caa2-4399-b83b-04cf27fe864c.png](images/264605ee-e889-80f8-a8ce-e89efa0548c5/264605ee-e889-80f8-a8ce-e89efa0548c5_9b8d38e4e30f5cd5ad8de7b63cd8cd24.png)


åœ¨è¿™ä¸ªä¾‹å­é‡Œï¼š

1. æ¨¡å‹å‘ç°ç”¨æˆ·é—®é¢˜æ¶‰åŠå®æ—¶ä¿¡æ¯ã€‚
2. å®ƒæ²¡æœ‰æœç´¢å·¥å…·æ— æ³•æä¾›å®æ—¶ä¿¡æ¯ï¼Œæ‰€ä»¥è°ƒç”¨ `human_assistance`è¯·æ±‚æä¾›æ›´å¤šä¿¡æ¯ã€‚
3. ç”¨æˆ·è¾“å…¥å®æ—¶ä¿¡æ¯åï¼ŒAgentç»§ç»­æ‰§è¡Œã€‚

è¿™æ ·ï¼Œæˆ‘ä»¬å°±å®ç°äº†ä¸€ä¸ª**Human-in-the-loop**çš„æµç¨‹ã€‚

