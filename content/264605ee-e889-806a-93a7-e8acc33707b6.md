---
title: ğŸ§¬ LangGraphè¿›é˜¶ï¼šæ„å»ºå¤šæ™ºèƒ½ä½“åä½œç³»ç»Ÿï¼ˆSupervisoræ¶æ„ä¸å­å›¾å®æˆ˜ï¼‰
description: æœ¬æ–‡æ˜¯ ã€ŠLangGraphå…¥é—¨å…¨è§£ã€‹ç³»åˆ—çš„ç¬¬äº”ç¯‡ã€‚å¤šæ™ºèƒ½ä½“åä½œæ˜¯ç°åœ¨ä¸€ä¸ªéå¸¸çƒ­é—¨çš„ç ”ç©¶é¢†åŸŸï¼Œå¯¹äºå¤æ‚é—®é¢˜ï¼Œå°†é—®é¢˜æ‹†è§£ï¼Œç„¶åä½¿ç”¨é¢†åŸŸAgentï¼Œèƒ½å¤Ÿä»¥æ›´é«˜çš„æ•ˆç‡å’Œè´¨é‡å®Œæˆå¤æ‚ä»»åŠ¡ã€‚LangGraphå¤šæ™ºèƒ½ä½“, LangGraphå­å›¾, Multi-Agent, Supervisoræ¶æ„
date: 2025-09-04
updateDate: 2025-09-04
tags: ["LLM","Prompt","LangChain","LangGraph","AI"]
cover: cover/264605ee-e889-806a-93a7-e8acc33707b6_b2c2ce517acc544ba861092cc222af33.png
---

æœ¬æ–‡æ˜¯ **ã€ŠLangGraphå…¥é—¨å…¨è§£ã€‹**[**LangGraphå…¥é—¨æŒ‡å—ï¼šä»åŸºç¡€ChatBotåˆ°å¤šæ™ºèƒ½ä½“å®æˆ˜**](https://www.wileyzhang.com/posts/264605ee-e889-806e-b847-ce4e7bcba614) ç³»åˆ—çš„ç¬¬äº”ç¯‡ã€‚å¤šæ™ºèƒ½ä½“åä½œæ˜¯ç°åœ¨ä¸€ä¸ªéå¸¸çƒ­é—¨çš„ç ”ç©¶é¢†åŸŸï¼Œå¯¹äºå¤æ‚é—®é¢˜ï¼Œå°†é—®é¢˜æ‹†è§£ï¼Œç„¶åä½¿ç”¨é¢†åŸŸAgentï¼Œèƒ½å¤Ÿä»¥æ›´é«˜çš„æ•ˆç‡å’Œè´¨é‡å®Œæˆå¤æ‚ä»»åŠ¡ã€‚å¦‚æœå‡ºä½ æ˜¯æ–°æ‰‹ï¼Œå»ºè®®å…ˆé˜…è¯»ä¸»æŒ‡å—ä»¥äº†è§£LangGraphçš„å…¨è²Œã€‚


# å¤šæ™ºèƒ½ä½“ä¸LangGraphå­å›¾


åœ¨æ„å»ºæ™ºèƒ½ä½“ç³»ç»Ÿä¸­ï¼Œæˆ‘ä»¬å¸¸å¸¸ä¼šé‡åˆ°ä¸‹é¢å‡ ä¸ªé—®é¢˜ï¼š

- å·¥å…·æ•°é‡è¿‡å¤šï¼Œä»£ç†åœ¨å†³å®šè°ƒç”¨å“ªä¸ªå·¥å…·æ—¶å®¹æ˜“å‡ºé”™ï¼›
- ä¸Šä¸‹æ–‡è¶Šæ¥è¶Šå¤æ‚ï¼Œå•ä¸ªä»£ç†éš¾ä»¥è¿½è¸ªå’Œç®¡ç†ï¼›
- ä»»åŠ¡éœ€è¦æ¶‰åŠå¤šä¸ªä¸“ä¸šé¢†åŸŸï¼ˆå¦‚è§„åˆ’å¸ˆã€ç ”ç©¶äººå‘˜ã€æ•°å­¦ä¸“å®¶ç­‰ï¼‰ï¼Œå•ä¸€Promptéš¾ä»¥ç¼–å†™ã€‚

è¿™äº›é—®é¢˜å°±åƒç°å®ç¤¾ä¼šä¸€æ ·ï¼šä¸åŒèŒä¸šçš„äººåˆ†å·¥æ˜ç¡®ï¼Œæ•ˆç‡å’Œå‡†ç¡®ç‡æ‰èƒ½æå‡ã€‚å¯¹äºæ™ºèƒ½ä½“ï¼ˆAgentï¼‰ç³»ç»Ÿæ¥è¯´ï¼ŒåŒæ ·éœ€è¦åˆç†åˆ†å·¥ä¸åä½œã€‚


## LangGrpahå­å›¾å®æˆ˜


åœ¨ LangGraph ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ **å­å›¾ï¼ˆSubgraphï¼‰** æ¥è§£å†³å¤æ‚ä»»åŠ¡çš„æ‹†è§£ä¸åˆ†å·¥ã€‚è¿™æ ·åšæœ‰å‡ ä¸ªå¥½å¤„ï¼š

1. **å¤æ‚ä»»åŠ¡æ‹†è§£ï¼š**å•ä¸ªä»£ç†ä¸“æ³¨äºä¸€éƒ¨åˆ†å·¥ä½œï¼Œä½¿ç³»ç»Ÿæ›´æ˜“äºå¼€å‘ã€æµ‹è¯•å’Œç»´æŠ¤ã€‚
2. **ä¸“ä¸šåŒ–ï¼š**æ¯ä¸ª Agent èšç„¦äºæŸä¸€é¢†åŸŸï¼ˆæœç´¢ã€åˆ†æã€å†³ç­–ã€æ‰§è¡Œï¼‰ã€‚
3. **å¹¶è¡Œä¸æ•ˆç‡ï¼š**å¤šä¸ªæ™ºèƒ½ä½“å¯å¹¶è¡Œå¤„ç†ä»»åŠ¡ï¼Œæ˜¾è‘—ç¼©çŸ­å®Œæˆæ—¶é—´ã€‚

åœ¨ LangGraph ä¸­ï¼Œå­å›¾çš„å®šä¹‰æ–¹å¼ä¸»è¦æœ‰ä¸¤ç§ï¼š

- **å…±äº«çŠ¶æ€ï¼š**å­å›¾å’Œçˆ¶å›¾ä½¿ç”¨åŒä¸€ä¸ªçŠ¶æ€å›¾ï¼Œé€‚ç”¨äºå°å‹ Agentã€‚
- **ä¸å…±äº«çŠ¶æ€ï¼š**å­å›¾ç»´æŠ¤è‡ªå·±çš„çŠ¶æ€å›¾ï¼Œåˆ†å·¥æ›´æ˜ç¡®ï¼Œé€‚ç”¨äºè¾ƒå¤æ‚çš„ç³»ç»Ÿã€‚

### å­å›¾ä¸çˆ¶å›¾å…±äº«çŠ¶æ€ç¤ºä¾‹


æ–°å»ºä¸€ä¸ªæ€»ç»“å†å²èŠå¤©è®°å½•çš„å­å›¾ï¼Œå¹¶ä½œä¸ºçˆ¶å›¾çš„ä¸€ä¸ªèŠ‚ç‚¹


```python
from typing import Annotated
from typing_extensions import TypedDict
from langchain_openai import ChatOpenAI
from langgraph.graph import StateGraph, START
from langgraph.constants import END
from langgraph.graph.message import add_messages
from langgraph.checkpoint.memory import InMemorySaver

# æ­¤å¤„å®šä¹‰ä½ è‡ªå·±çš„æ¨¡å‹
llm = ChatOpenAI(model="qwen3_32")
memory = InMemorySaver()
# å®šä¹‰å›¾çŠ¶æ€
class State(TypedDict):
    messages: Annotated[list, add_messages]  # æ­¤å¤„ç»´æŠ¤å®Œæ•´çš„æ¶ˆæ¯å†å²
    mem0_user_id: str
    preference: str
# å­å›¾ï¼Œ ä½¿ç”¨ä¸çˆ¶å›¾åŒæ ·çš„çŠ¶æ€
child_graph = StateGraph(State)
def summarize_memory(state: State):
"""æ€»ç»“è¿‡å¾€çš„å†å²èŠå¤©"""summary_prompt = [
        {
            "role": "system",
            "content": "ä½ æ˜¯ä¸€ä¸ªæ€»ç»“åŠ©æ‰‹ï¼Œè¯·ç”¨ç®€æ˜æ‰¼è¦çš„è¯­è¨€æ€»ç»“å¯¹è¯å†å²ã€‚",
        },
        {"role": "user", "content": str(state["messages"])},
    ]
    result = llm.invoke(summary_prompt)
    return {"preference": result.content}
child_graph.add_node("summarize", summarize_memory)
child_graph.add_edge("summarize", END)
child_graph.add_edge(START, "summarize")
child_graph_compile = child_graph.compile()

# çˆ¶å›¾
parent_graph = StateGraph(State)
def chatbot(state: State):
    return {"messages": [llm.invoke(state["messages"])]}
parent_graph.add_node("chatbot", chatbot)
# æ·»åŠ å­å›¾èŠ‚ç‚¹
parent_graph.add_node("child_graph", child_graph_compile)
parent_graph.add_edge("chatbot", "child_graph")
parent_graph.add_edge("child_graph", END)
parent_graph.add_edge(START, "chatbot")
app = parent_graph.compile(checkpointer=memory)

if __name__ == "__main__":
    while True:
        user_input = input("ğŸ‘¨ğŸ’»: ")
        if user_input.lower() in ["quit", "exit", "q"]:
            print("Exiting...")
            break
        response = app.invoke(
            {"messages": {"role": "user", "content": user_input}},
            config={"configurable": {"thread_id": "1"}},
        )
        messages = response["messages"]
        print(f'ğŸ¤–: {response["messages"][-1].content}')
        print("--" * 10)
        print(f'ğŸ”…å†å²èŠå¤©è®°å½•æ€»ç»“: {response["preference"]}')
```


### å­å›¾ä¸çˆ¶å›¾ä¸å…±äº«çŠ¶æ€ç¤ºä¾‹


å¦‚æœå­å›¾å’Œçˆ¶å›¾çŠ¶æ€ä¸å…±äº«ï¼Œå¯ä»¥å®šä¹‰å­å›¾è‡ªå·±çš„çŠ¶æ€ï¼Œå¹¶é€šè¿‡è°ƒç”¨ä¸çˆ¶å›¾äº¤äº’


```python
# çœç•¥é‡å¤ä»£ç 
class ChildState(TypedDict):
    messages: Annotated[list, add_messages]
    preference: str

# å­å›¾ï¼Œä½¿ç”¨å­å›¾è‡ªå®šä¹‰çš„çŠ¶æ€
child_graph = StateGraph(ChildState)
def summarize_memory(state: State):
"""æ€»ç»“è¿‡å¾€çš„å†å²èŠå¤©"""summary_prompt = [
        {
            "role": "system",
            "content": "ä½ æ˜¯ä¸€ä¸ªæ€»ç»“åŠ©æ‰‹ï¼Œè¯·ç”¨ç®€æ˜æ‰¼è¦çš„è¯­è¨€æ€»ç»“å¯¹è¯å†å²ã€‚",
        },
        {"role": "user", "content": str(state["messages"])},
    ]
    result = llm.invoke(summary_prompt)
    return {"preference": result.content}
child_graph.add_node("summarize", summarize_memory)
child_graph.add_edge("summarize", END)
child_graph.add_edge(START, "summarize")
child_graph_compile = child_graph.compile()

# çˆ¶å›¾
parent_graph = StateGraph(State)
def chatbot(state: State):
    return {"messages": [llm.invoke(state["messages"])]}

# ç¼–å†™å­å›¾è°ƒç”¨å‡½æ•°
def call_subgraph(state: State):
    response = child_graph_compile.invoke({"messages": state["messages"]})
    return {"preference": response["preference"]}

parent_graph.add_node("chatbot", chatbot)
# æ·»åŠ å­å›¾èŠ‚ç‚¹
parent_graph.add_node("child_graph", call_subgraph)
parent_graph.add_edge("chatbot", "child_graph")
parent_graph.add_edge("child_graph", END)
parent_graph.add_edge(START, "chatbot")
app = parent_graph.compile(checkpointer=memory)
# çœç•¥ è¿è¡Œä»£ç 
```


### è¿è¡Œæ•ˆæœå¦‚ä¸‹


![330de738-60ea-46da-a655-61002bb9e590.png](images/264605ee-e889-806a-93a7-e8acc33707b6/264605ee-e889-806a-93a7-e8acc33707b6_71ba815700b57c8f5243584bfdf179ac.png)


## LangGraphå¤šæ™ºèƒ½ä½“åä½œ


### å¸¸è§å¤šæ™ºèƒ½ä½“æ¶æ„


é™¤äº†å­å›¾æœºåˆ¶ï¼ŒLangGraph è¿˜æ”¯æŒå¤šæ™ºèƒ½ä½“ï¼ˆMulti-Agentï¼‰æ¶æ„ã€‚å¸¸è§çš„å¤šæ™ºèƒ½ä½“åä½œæ¨¡å¼ä¸»è¦æœ‰ä»¥ä¸‹ 5 ç§ï¼š


![19101beb-39c7-444d-82f8-f05dea25a09b.png](images/264605ee-e889-806a-93a7-e8acc33707b6/264605ee-e889-806a-93a7-e8acc33707b6_42f354be856b5206e49187938d968dee.png)

- **ç½‘ç»œå‹ï¼š**æ‰€æœ‰ä»£ç†å½¼æ­¤é€šä¿¡ï¼Œä»»ä½•ä»£ç†éƒ½èƒ½å†³å®šä¸‹ä¸€ä¸ªè¦è°ƒç”¨çš„ä»£ç†ã€‚
- **ä¸»ç®¡å‹ï¼š**æ‰€æœ‰ä»£ç†ä¸ä¸€ä¸ªä¸»ç®¡ä»£ç†é€šä¿¡ï¼Œç”±ä¸»ç®¡ä»£ç†å†³å®šè°ƒç”¨é¡ºåºã€‚
- **ä¸»ç®¡ + å·¥å…·è°ƒç”¨å‹ï¼š**ä¸»ç®¡ä»£ç†å°†å…¶ä»–ä»£ç†è§†ä¸ºå·¥å…·ï¼Œé€šè¿‡ LLM å·¥å…·è°ƒç”¨æ¥åè°ƒå·¥ä½œã€‚
- **åˆ†å±‚å‹ï¼š**åœ¨ä¸»ç®¡å‹åŸºç¡€ä¸Šè¿›ä¸€æ­¥æŠ½è±¡ï¼Œå½¢æˆå¤šå±‚ä¸»ç®¡ç»“æ„ï¼Œé€‚ç”¨äºæ›´å¤æ‚çš„ä»»åŠ¡ã€‚
- **è‡ªå®šä¹‰å·¥ä½œæµå‹**ï¼šæ¯ä¸ªä»£ç†åªä¸éƒ¨åˆ†ä»£ç†é€šä¿¡ï¼Œéƒ¨åˆ†ä»»åŠ¡æµæ˜¯ç¡®å®šæ€§çš„ï¼Œéƒ¨åˆ†åˆ™ç”±ä»£ç†è‡ªä¸»å†³å®šã€‚

### å¤šæ™ºèƒ½ä½“ä¸»ç®¡æ¶æ„å®æˆ˜


åœ¨å®é™…åº”ç”¨ä¸­ï¼Œ**ä¸»ç®¡æ¶æ„**æ˜¯æœ€å¸¸è§çš„ä¸€ç§å¤šæ™ºèƒ½ä½“åä½œæ–¹å¼ã€‚ä¸‹é¢æˆ‘ä»¬é€šè¿‡ä¸€ä¸ª **â€œé¢„è®¢æœºç¥¨ã€é…’åº—â€** çš„ä¾‹å­ï¼Œå±•ç¤ºå¦‚ä½•å®ç°ä¸»ç®¡æ¶æ„ã€‚


![d39a0183-cf0d-40e1-bcf8-1fee5296d2fa.png](images/264605ee-e889-806a-93a7-e8acc33707b6/264605ee-e889-806a-93a7-e8acc33707b6_5a39071cdcf5c31ca64d6c1161bca185.png)


ç¤ºä¾‹ä»£ç 


```python
from langchain_openai import ChatOpenAI
from langgraph.checkpoint.memory import InMemorySaver
from langgraph.prebuilt import create_react_agent
from langgraph_supervisor import create_supervisor
# æ­¤å¤„å®šä¹‰ä½ è‡ªå·±çš„æ¨¡å‹
llm = ChatOpenAI(model="qwen3_32")
memory = InMemorySaver()
def book_hotel(hotel_name: str):
"""Book a hotel"""return f"å·²æˆåŠŸé¢„è®¢ä½å®¿ {hotel_name}."

def book_flight(from_airport: str, to_airport: str):
"""Book a flight"""return f"æˆåŠŸé¢„è®¢äº†èˆªç­ä»{from_airport}åˆ°{to_airport}."
flight_assistant = create_react_agent(
    model=llm,
    tools=[book_flight],
    prompt="ä½ æ˜¯èˆªç­é¢„è®¢åŠ©ç†",
    name="flight_assistant"
)
hotel_assistant = create_react_agent(
    model=llm,
    tools=[book_hotel],
    prompt="ä½ æ˜¯é…’åº—é¢„è®¢åŠ©ç†",
    name="hotel_assistant"
)
app = create_supervisor(
    agents=[flight_assistant, hotel_assistant],
    model=llm,
    prompt="ä½ ç®¡ç†ä¸€ä¸ªé…’åº—é¢„è®¢åŠ©ç†å’Œä¸€ä¸ªèˆªç­é¢„è®¢åŠ©ç†ã€‚å°†å·¥ä½œåˆ†é…ç»™ä»–ä»¬ï¼Œå®Œæˆç”¨æˆ·ç»™å‡ºçš„ä»»åŠ¡ï¼Œä¸è¦è¯¢é—®æ›´å¤šä¿¡æ¯ã€‚"
).compile()

if __name__ == "__main__":
    while True:
        user_input = input("ğŸ‘¨ğŸ’»: ")
        if user_input.lower() in ["quit", "exit", "q"]:
            print("Exiting...")
            break
        response = app.invoke(
            {"messages": {"role": "user", "content": user_input}},
            config={"configurable": {"thread_id": "1"}},
        )
        for m in response["messages"]:
            print(m.pretty_print())
```


æ•ˆæœå¦‚ä¸‹


![8f93f182-6f2a-48ea-94c4-d9cbef6a9017.png](images/264605ee-e889-806a-93a7-e8acc33707b6/264605ee-e889-806a-93a7-e8acc33707b6_ec87c675ad8a37c745efb3efe21e385e.png)

